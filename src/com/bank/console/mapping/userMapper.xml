<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bank.console.mapper.UserMapper">
	<!-- 新增用户 -->
 	<insert id="addUser"  parameterType="User">
	   insert into tb_user(
	   		userId,
	   		realName,
	   		roleId,
	   		deptId,
	   		phone,
	   		mobile,
	   		email,
	   		pass
	   ) values(
	   	 	#{userId, jdbcType=VARCHAR},
	   	 	#{realName, jdbcType=VARCHAR},
	   	 	#{roleId, jdbcType=INTEGER},
	   	 	#{deptId, jdbcType=VARCHAR},
	   	 	#{phone, jdbcType=VARCHAR},
	   	 	#{mobile, jdbcType=VARCHAR},
	   	 	#{email, jdbcType=VARCHAR}
	   	 	#{pass, jdbcType=VARCHAR}
	   )
	</insert>
	
	<!-- 修改 -->
	<update id="updateUser" parameterType="User">
		update tb_user 
			<set>
				<if test="realName != null and realName != ''">
				 	realName = #{realName, jdbcType=VARCHAR},
				 </if>
				 <if test="roleId != null and roleId != ''">
				 	roleId = #{roleId, jdbcType=INTEGER},
				 </if>
				 <if test="deptId != null and deptId != ''">
				 	deptId = #{deptId, jdbcType=INTEGER},
				 </if>
				 <if test="phone != null and phone != ''">
				 	phone = #{phone, jdbcType=VARCHAR},
				 </if>
				 <if test="mobile != null and mobile != ''">
				 	mobile = #{mobile, jdbcType=VARCHAR},
				 </if>
				  <if test="email != null and email != ''">
				  	email = #{email, jdbcType=VARCHAR}
				  </if>
				 <if test="pass != null and pass != ''">
				 	pass = #{pass, jdbcType=VARCHAR}
				 </if>
				where userId = #{userId, jdbcType=VARCHAR}
			</set> 
	</update>
	
	<!-- 删除 -->
	<delete id="deleteUser">
		delete from tb_user where userId = #{userId, jdbcType=VARCHAR}
	</delete>
	
	<!-- 查询数量 -->
 	<select id="getUserSum" resultType="INTEGER" parameterType="java.util.Map">
	    SELECT   
		    	count(1) as sum
		    FROM
		      tb_user u, tb_dept d, tb_role r
		    <where>
		    	u.deptId = d.deptId and u.roleId = r.roleId
		    	<if test="realName != null and realName != ''">
					and u.realName like '%${realName}%'
				</if>
				<if test="userId != null and userId != ''">
					and u.userId = #{userId, jdbcType=VARCHAR}
				</if>
				<if test="phone != null and phone != ''">
					and u.phone = #{phone, jdbcType=VARCHAR}
				</if>
				<if test="mobile != null and mobile != ''">
					and u.mobile = #{mobile, jdbcType=VARCHAR}
				</if>
				<if test="deptId != null and deptId != ''">
					and u.deptId = #{deptId, jdbcType=VARCHAR}
				</if>
		    </where>
	</select>
	
	<sql id="columns">
              u.userId,
              u.realName,
		      u.phone,
		      u.mobile,
		      u.email,
		      DATE_FORMAT(u.createDate,'%Y-%m-%d %H:%i')   AS createDateStr,
		      DATE_FORMAT(u.updateDate,'%Y-%m-%d %H:%i')   AS updateDateStr,
		      d.deptId,
		      d.deptName,
		      r.roleId,
		      r.roleName
	</sql>
	<!-- 查询 -->
 	<select id="getUserList" resultType="UserVO">
		 	SELECT   
		    	<include refid="columns"/>
		    FROM
		      tb_user u, tb_dept d, tb_role r
		    <where>
		    	u.deptId = d.deptId and u.roleId = r.roleId
		    	<if test="realName != null and realName != ''">
					and u.realName like '%${realName}%'
				</if>
				<if test="userId != null and userId != ''">
					and u.userId = #{userId, jdbcType=VARCHAR}
				</if>
				<if test="phone != null and phone != ''">
					and u.phone = #{phone, jdbcType=VARCHAR}
				</if>
				<if test="mobile != null and mobile != ''">
					and u.mobile = #{mobile, jdbcType=VARCHAR}
				</if>
				<if test="deptId != null and deptId != ''">
					and u.deptId = #{deptId, jdbcType=VARCHAR}
				</if>
		    </where>
		    order by u.userId
			limit #{startRow}, #{endRow}
	</select>
	
	<!--查询用户-->
 	<select id="findUser" resultType="User">
	    SELECT
	      *
	    FROM
	      tb_user
	    where userId = #{userId, jdbcType=VARCHAR}
	</select>
	
	<!--查询用户信息 -->
 	<select id="getUserInfo" resultType="User">
	    SELECT
	      *
	    FROM
	      tb_user
	    where userId = #{userId, jdbcType=VARCHAR}
	</select>
	
</mapper>